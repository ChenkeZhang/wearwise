<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WearWise</title>
    <meta name="description" content="ä½ çš„æç®€ç©¿è¡£åŠ©æ‰‹">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3b82f6">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/4720/4720636.png">
    <style>
        body { -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
    </style>
</head>
<body class="bg-gradient-to-b from-blue-400 to-blue-600 min-h-screen text-white flex flex-col items-center justify-center transition-colors duration-1000" id="bg">

    <div class="text-center p-6 w-full max-w-md">
        <div class="text-8xl mb-4 animate-bounce" id="icon">ğŸ¤”</div>
        
        <h1 class="text-4xl font-bold mb-2 drop-shadow-md" id="suggestion">åˆ†æå¤©æ°”ä¸­...</h1>
        
        <div class="glass rounded-xl p-4 mt-8 space-y-2">
            <p class="text-lg opacity-90">ä½“æ„Ÿæ¸©åº¦: <span id="temp" class="font-mono font-bold">--</span>Â°C</p>
            <p class="text-lg opacity-90">é™é›¨æ¦‚ç‡: <span id="rain" class="font-mono font-bold">--</span>%</p>
            <p class="text-sm opacity-75 mt-2" id="city">å®šä½ä¸­...</p>
        </div>

        <button onclick="getWeather()" class="mt-8 bg-white text-blue-600 px-6 py-3 rounded-full font-bold shadow-lg active:scale-95 transition-transform">
            åˆ·æ–°å»ºè®®
        </button>
    </div>

    <div id="install-guide" class="hidden fixed bottom-0 left-0 w-full bg-white text-gray-800 p-6 rounded-t-3xl shadow-2xl z-50 transform transition-transform translate-y-full">
        <div class="flex justify-between items-start mb-4">
            <h3 class="text-xl font-bold">å®‰è£… WearWise</h3>
            <button onclick="closeGuide()" class="text-gray-400 text-2xl">&times;</button>
        </div>
        <p class="mb-4">ä¸ºäº†æ¯å¤©æ—©ä¸Šæé†’ä½ ï¼Œè¯·æŠŠæˆ‘ä»¬è£…è¿›æ‰‹æœºï¼š</p>
        <ol class="list-decimal list-inside space-y-2 text-sm">
            <li>ç‚¹å‡»åº•éƒ¨çš„ <span class="font-bold">åˆ†äº«</span> æŒ‰é’® <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/4b/Feather-core-share.svg/1200px-Feather-core-share.svg.png" class="inline w-4 h-4"></li>
            <li>å‘ä¸‹æ»‘åŠ¨ï¼Œé€‰æ‹© <span class="font-bold">æ·»åŠ åˆ°ä¸»å±å¹•</span></li>
        </ol>
        <div class="text-center mt-4 text-blue-500 animate-bounce">ğŸ‘‡ å°±æ˜¯è¿™é‡Œ</div>
    </div>

    <script>
        // ================= é…ç½®åŒº =================
        // âš ï¸ æŒ‡æŒ¥å®˜ï¼Œè¯·æŠŠä½ çš„ Key å¡«åœ¨ä¸‹é¢å¼•å·é‡Œ
        const API_KEY = "3806f393ab45ce4b1b18655b0d5733c0"; 
        // ========================================

        // æ ¸å¿ƒé€»è¾‘ç®—æ³• (WearWise Brain v1.0)
        function analyze(feelsLike, rainPop) {
            let result = { icon: "ğŸ¤”", text: "", bg: "from-blue-400 to-blue-600" };

            // 1. å…ˆåˆ¤æ–­é›¨
            if (rainPop >= 0.4) {
                result.icon = "â˜”ï¸";
                result.text = "å¸¦ä¼ï¼åˆ«ä¾¥å¹¸ï¼";
                result.bg = "from-gray-600 to-gray-800"; // ä¸‹é›¨å˜æš—
                return result;
            }

            // 2. å†åˆ¤æ–­æ¸©åº¦
            if (feelsLike > 23) {
                result.icon = "â˜€ï¸";
                result.text = "çŸ­è¢– / çƒ­è£¤";
                result.bg = "from-orange-400 to-red-500";
            } else if (feelsLike >= 16) {
                result.icon = "ğŸ‘•";
                result.text = "é•¿è¢– / è–„å¤–å¥—";
                result.bg = "from-green-400 to-teal-500";
            } else if (feelsLike >= 10) {
                result.icon = "ğŸ§¥";
                result.text = "å«è¡£ / å¤¹å…‹";
                result.bg = "from-blue-400 to-indigo-500";
            } else if (feelsLike >= 5) {
                result.icon = "ğŸ§£";
                result.text = "åšå¤–å¥— / å¤§è¡£";
                result.bg = "from-indigo-600 to-purple-700";
            } else {
                result.icon = "ğŸ¥¶";
                result.text = "ç¾½ç»’æœ / ä¿å‘½";
                result.bg = "from-slate-700 to-slate-900";
            }
            return result;
        }

        // è·å–å¤©æ°”
        function getWeather() {
            document.getElementById('suggestion').innerText = "è¯»å–å«æ˜Ÿæ•°æ®...";
            
            if (!navigator.geolocation) {
                alert("éœ€è¦å®šä½æƒé™æ‰èƒ½å‘Šè¯‰ä½ ç©¿ä»€ä¹ˆå“¦ï¼");
                return;
            }

            navigator.geolocation.getCurrentPosition(async (position) => {
                const lat = position.coords.latitude;
                const lon = position.coords.longitude;
                
                try {
                    const url = `https://api.openweathermap.org/data/2.5/onecall?lat=${lat}&lon=${lon}&exclude=minutely,hourly,alerts&units=metric&lang=zh_cn&appid=${API_KEY}`;
                    
                    // æ³¨æ„ï¼šOneCall API éœ€è¦å¼€é€šæƒé™ã€‚å¦‚æœæ˜¯å…è´¹ç‰ˆæ ‡å‡† Keyï¼Œå¯èƒ½éœ€è¦ç”¨ Weather API
                    // å¤‡ç”¨æ–¹æ¡ˆï¼šä½¿ç”¨æ ‡å‡† Weather API (ä»…å½“å‰å¤©æ°”)
                    const backupUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=zh_cn&appid=${API_KEY}`;
                    
                    const response = await fetch(backupUrl);
                    const data = await response.json();

                    if(data.cod !== 200) throw new Error(data.message);

                    const feelsLike = Math.round(data.main.feels_like);
                    // æ ‡å‡† API æ²¡æœ‰é™æ°´æ¦‚ç‡(pop)ï¼Œè¿™é‡Œæš‚ç”¨ cloudy ä»£æ›¿æˆ–è®¾ä¸º0ç”¨äº MVP æµ‹è¯•
                    // çœŸæ­£çš„ç”Ÿäº§ç¯å¢ƒæˆ‘ä»¬éœ€è¦å‡çº§ API æˆ–æ¢ç”¨æ”¯æŒ pop çš„å…è´¹æ¥å£
                    const rainPop = data.rain ? 1 : 0; // ç®€å•ç²—æš´é€»è¾‘ï¼šæœ‰ rain å­—æ®µå°±æ˜¯ä¸‹é›¨

                    // æ›´æ–° UI
                    const advice = analyze(feelsLike, rainPop);
                    
                    document.getElementById('icon').innerText = advice.icon;
                    document.getElementById('suggestion').innerText = advice.text;
                    document.getElementById('temp').innerText = feelsLike;
                    document.getElementById('rain').innerText = rainPop > 0 ? ">40" : "0"; // MVP æ¨¡æ‹Ÿ
                    document.getElementById('city').innerText = data.name;
                    
                    // æ”¹å˜èƒŒæ™¯è‰²
                    document.getElementById('bg').className = `min-h-screen text-white flex flex-col items-center justify-center transition-colors duration-1000 bg-gradient-to-b ${advice.bg}`;

                } catch (error) {
                    console.error(error);
                    document.getElementById('suggestion').innerText = "è·å–å¤±è´¥";
                    alert("å¤©æ°”æ¥å£æŠ¥é”™ï¼Œè¯·æ£€æŸ¥ Key æˆ–ç½‘ç»œ");
                }
            });
        }

        // PWA å®‰è£…å¼•å¯¼æ£€æµ‹
        function checkInstall() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isStandalone = window.navigator.standalone || (window.matchMedia('(display-mode: standalone)').matches);
            
            if (isIOS && !isStandalone) {
                const guide = document.getElementById('install-guide');
                guide.classList.remove('hidden');
                setTimeout(() => guide.classList.remove('translate-y-full'), 100);
            }
        }

        function closeGuide() {
            document.getElementById('install-guide').classList.add('translate-y-full');
        }

        // æ³¨å†Œ Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js');
        }

        // å¯åŠ¨æ—¶è¿è¡Œ
        getWeather();
        setTimeout(checkInstall, 2000); // 2ç§’åæ˜¾ç¤ºå¼•å¯¼
    </script>
</body>
</html>
